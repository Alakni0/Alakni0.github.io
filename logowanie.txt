<?php
session_start();
require "db.php";

$bladLogowanie = "";

if (($_SERVER["REQUEST_METHOD"] === "POST" && isset($_POST["login_btn"]))) {
    $login = trim($_POST["login"]);
    $password = $_POST["password"];

    if ($login === "" || $password === "") {
         $bladLogowanie = "Uzupełnij wszystkie pola.";
    } else {
        $stmt = $connection->prepare("SELECT * FROM konta WHERE login = ?");
        $stmt->bind_param("s", $login);
        $stmt->execute();
        $result = $stmt->get_result();
        $user = $result->fetch_assoc();

        if ($user && password_verify($password, $user["password"])) {
            $_SESSION["user"] = $user["login"];
            header("Location: dashboard.php");
            exit();
        } else {
            $bladLogowanie = "Niepoprawny login lub hasło.";
        }
        $stmt->close();
    }
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Logowanie</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h2>Logowanie</h2>
    <form method="POST">
        <label>Login:</label><br>
        <input type="text" name="login"><br>

        <label>Hasło:</label><br>
        <input type="password" name="password"><br>

        <button type="submit" name="login_btn">Zaloguj</button>


    </form>

    <p class="error"><?php echo $bladLogowanie; ?></p>

    <hr>
    <p>Nie masz konta?</p>
    <a href="rejestracja.php">Przejdź do rejestracji</a>
</div>

</body>
</html>